networks:
  stan-internal:
    driver: bridge
    internal: true
  stan-external:
    driver: bridge

services:
  stan-orchestrator:
    container_name: stan-orchestrator
    build:
      context: ./orchestrator
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents:/app/agents
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=orchestrator
      - NODE_ENV=production
    networks:
      - stan-internal
    restart: unless-stopped

  magnus:
    container_name: magnus
    build:
      context: ./agents/magnus
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/magnus:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=magnus
      - NODE_ENV=production
    networks:
      - stan-internal
      - stan-external
    restart: unless-stopped
    depends_on:
      - stan-orchestrator

  pete:
    container_name: pete
    build:
      context: ./agents/pete
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/pete:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=pete
      - NODE_ENV=production
    networks:
      - stan-internal
    restart: unless-stopped
    depends_on:
      - stan-orchestrator

  caesar:
    container_name: caesar
    build:
      context: ./agents/caesar
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/caesar:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=caesar
      - NODE_ENV=production
      - EPICOR_BASE_URL=${EPICOR_BASE_URL}
      - EPICOR_API_KEY=${EPICOR_API_KEY}
    networks:
      - stan-internal
      - stan-external
    restart: unless-stopped
    depends_on:
      - stan-orchestrator

  maggie:
    container_name: maggie
    build:
      context: ./agents/maggie
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/maggie:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=maggie
      - NODE_ENV=production
    networks:
      - stan-internal
    restart: unless-stopped
    depends_on:
      - stan-orchestrator

  clark:
    container_name: clark
    build:
      context: ./agents/clark
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/clark:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=clark
      - NODE_ENV=production
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_KEY=${SUPABASE_SERVICE_KEY}
    networks:
      - stan-internal
      - stan-external
    restart: unless-stopped
    depends_on:
      - stan-orchestrator

  sentry:
    container_name: sentry
    build:
      context: ./agents/sentry
      dockerfile: Dockerfile
    working_dir: /app
    volumes:
      - ./agents/sentry:/app/agent
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    ports:
      - "3000:3000"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - ROLE=sentry
      - NODE_ENV=production
    networks:
      - stan-internal
      - stan-external
    restart: unless-stopped
    depends_on:
      - stan-orchestrator
